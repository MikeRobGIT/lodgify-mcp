# Task ID: 8
# Title: Add Messaging Tool and Health Resource
# Status: done
# Dependencies: 7
# Priority: medium
# Description: Implement the messaging thread retrieval tool and the health check resource for connectivity verification
# Details:
Complete the implementation with:
1. In lodgify.ts, add getThread method:
   - GET /v2/messaging/{threadGuid}
   - Validate GUID format
2. In server.ts, add:
   - Tool registration for lodgify.get_thread
   - Resource handler for lodgify://health
   - Health check returns: { ok: true, baseUrl: 'https://api.lodgify.com' }

Implementation:
```typescript
// In lodgify.ts
public async getThread(threadGuid: string) {
  if (!threadGuid) throw new Error('Thread GUID is required');
  // Optional: validate GUID format
  const guidRegex = /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;
  if (!guidRegex.test(threadGuid)) {
    throw new Error('Invalid thread GUID format');
  }
  return this.request('GET', `/v2/messaging/${threadGuid}`);
}

// In server.ts - Resource handler
server.setRequestHandler('resources/list', async () => ({
  resources: [{
    uri: 'lodgify://health',
    name: 'Health Check',
    description: 'Check Lodgify MCP server health',
    mimeType: 'application/json'
  }]
}));

server.setRequestHandler('resources/read', async (request) => {
  if (request.params.uri === 'lodgify://health') {
    return {
      contents: [{
        uri: 'lodgify://health',
        mimeType: 'application/json',
        text: JSON.stringify({ ok: true, baseUrl: 'https://api.lodgify.com' })
      }]
    };
  }
  throw new Error('Resource not found');
});
```

# Test Strategy:
Tests: 1) Get thread with valid GUID, 2) Reject invalid GUID format, 3) Health resource returns correct JSON structure, 4) Resource list includes health check, 5) Unknown resource returns error

# Subtasks:
## 1. Implement getThread method in Lodgify client [done]
### Dependencies: None
### Description: Add the getThread method to lodgify.ts with GUID validation and proper error handling for the messaging endpoint
### Details:
In lodgify.ts, implement the getThread method that:
1. Accepts threadGuid parameter
2. Validates the GUID format using regex pattern /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i
3. Throws descriptive errors for missing or invalid GUID
4. Makes GET request to /v2/messaging/{threadGuid}
5. Returns the thread data from the API response

## 2. Register messaging tool and implement health resource handler [done]
### Dependencies: 8.1
### Description: Add tool registration for lodgify.get_thread and implement the health check resource handler in server.ts
### Details:
In server.ts:
1. Register lodgify.get_thread tool with Zod schema for threadGuid validation
2. Implement resources/list handler to expose lodgify://health resource
3. Implement resources/read handler that returns { ok: true, baseUrl: 'https://api.lodgify.com' } for health checks
4. Ensure proper error handling for unknown resource URIs
5. Add appropriate tool description for the messaging endpoint

